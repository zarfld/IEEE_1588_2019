<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IEEE 1588-2019 PTP Library: IEEE 1588-2019 PTP Library - API Reference Guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">IEEE 1588-2019 PTP Library<span id="projectnumber">&#160;1.0.0-MVP</span>
   </div>
   <div id="projectbrief">Hardware-agnostic IEEE 1588-2019 PTPv2 implementation with deterministic design</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('db/d79/md__2home_2runner_2work_2IEEE__1588__2019_2IEEE__1588__2019_208-transition_2user-documentation_2api-reference.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">IEEE 1588-2019 PTP Library - API Reference Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1"></a> <b>Version</b>: 1.0.0-MVP <br  />
 <b>Date</b>: 2025-11-11 <br  />
 <b>Audience</b>: Software Engineers integrating PTP library <br  />
 <b>Compliance</b>: <a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Precision Time Protocol v2.1</p>
<hr  />
<h1><a class="anchor" id="autotoc_md24"></a>
Table of Contents</h1>
<ol type="1">
<li>Introduction</li>
<li>Core Types and Constants</li>
<li>Clock State Machines</li>
<li>Message Handling</li>
<li>Data Sets</li>
<li>Hardware Abstraction Layer (HAL)</li>
<li>Best Master Clock Algorithm (BMCA)</li>
<li>Error Handling</li>
<li>Usage Examples</li>
<li>Platform Integration</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md26"></a>
1. Introduction</h1>
<h2><a class="anchor" id="autotoc_md27"></a>
1.1 Overview</h2>
<p>The <a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 PTP Library provides a complete, hardware-agnostic implementation of the Precision Time Protocol (PTP) v2.1. The library is designed for integration into embedded systems, real-time applications, and time-sensitive networking equipment.</p>
<p><b>Key Features</b>:</p><ul>
<li>✅ <b><a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Compliant</b>: Full support for mandatory message types</li>
<li>✅ <b>Hardware Agnostic</b>: No vendor-specific dependencies</li>
<li>✅ <b>Deterministic Design</b>: Bounded execution time, no dynamic allocation</li>
<li>✅ <b>Real-Time Ready</b>: Non-blocking operations, predictable performance</li>
<li>✅ <b>Highly Tested</b>: 90.2% code coverage, 100% passing tests</li>
</ul>
<h2><a class="anchor" id="autotoc_md28"></a>
1.2 Namespace Structure</h2>
<p>All library components are organized under the <a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 namespace hierarchy:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="../../d0/d1c/namespaceIEEE.html">IEEE</a> {</div>
<div class="line"><span class="keyword">namespace </span>_1588 {</div>
<div class="line"><span class="keyword">namespace </span>PTP {</div>
<div class="line"><span class="keyword">namespace </span>_2019 {</div>
<div class="line">    <span class="comment">// Core types</span></div>
<div class="line">    <span class="keyword">namespace </span>Types { <span class="comment">/* ... */</span> }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Clock state machines</span></div>
<div class="line">    <span class="keyword">namespace </span>Clocks { <span class="comment">/* ... */</span> }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Message formats</span></div>
<div class="line">    <span class="comment">// AnnounceMessage, SyncMessage, etc.</span></div>
<div class="line">}}}}</div>
<div class="ttc" id="anamespaceIEEE_html"><div class="ttname"><a href="../../d0/d1c/namespaceIEEE.html">IEEE</a></div><div class="ttdoc">Top-level IEEE standards namespace.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc5/clocks_8hpp_source.html#l00043">clocks.hpp:43</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md29"></a>
1.3 Design Principles</h2>
<p><b>Deterministic Execution</b>:</p><ul>
<li>All operations have bounded execution time</li>
<li>No dynamic memory allocation in critical paths</li>
<li>No blocking calls or exceptions</li>
<li>POD (Plain Old Data) structures for predictable memory layout</li>
</ul>
<p><b>Hardware Abstraction</b>:</p><ul>
<li>Interface-based hardware access via callback functions</li>
<li>No OS-specific or vendor-specific code</li>
<li>Compile-time platform selection</li>
</ul>
<p><b>Standards Compliance</b>:</p><ul>
<li>Strict adherence to <a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 specification</li>
<li>All message formats match standard exactly</li>
<li>BMCA implementation per Section 9.3</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md31"></a>
2. Core Types and Constants</h1>
<h2><a class="anchor" id="autotoc_md32"></a>
2.1 Basic Integer Types</h2>
<div class="fragment"><div class="line"><span class="keyword">using </span>UInteger8 = std::uint8_t;   <span class="comment">// 8-bit unsigned integer</span></div>
<div class="line"><span class="keyword">using </span>UInteger16 = std::uint16_t; <span class="comment">// 16-bit unsigned integer</span></div>
<div class="line"><span class="keyword">using </span>UInteger32 = std::uint32_t; <span class="comment">// 32-bit unsigned integer</span></div>
<div class="line"><span class="keyword">using </span>UInteger64 = std::uint64_t; <span class="comment">// 64-bit unsigned integer</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>Integer8 = std::int8_t;     <span class="comment">// 8-bit signed integer</span></div>
<div class="line"><span class="keyword">using </span>Integer16 = std::int16_t;   <span class="comment">// 16-bit signed integer</span></div>
<div class="line"><span class="keyword">using </span>Integer32 = std::int32_t;   <span class="comment">// 32-bit signed integer</span></div>
<div class="line"><span class="keyword">using </span>Integer64 = std::int64_t;   <span class="comment">// 64-bit signed integer</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md33"></a>
2.2 PTP-Specific Types</h2>
<h3><a class="anchor" id="autotoc_md34"></a>
ClockIdentity</h3>
<p>64-bit unique identifier for each PTP clock (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 5.3.4):</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>ClockIdentity = std::array&lt;std::uint8_t, 8&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Example usage</span></div>
<div class="line">ClockIdentity clock_id = {0x00, 0x1B, 0x21, 0xFF, 0xFE, 0x00, 0x12, 0x34};</div>
</div><!-- fragment --><p><b>Usage</b>: Uniquely identifies a PTP clock in the network. Typically derived from MAC address with 0xFFFE inserted in the middle.</p>
<h3><a class="anchor" id="autotoc_md35"></a>
PortNumber</h3>
<p>Identifies a specific port on a PTP clock (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 5.3.5):</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>PortNumber = UInteger16;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Example usage</span></div>
<div class="line">PortNumber port1 = 1;  <span class="comment">// First port</span></div>
<div class="line">PortNumber port2 = 2;  <span class="comment">// Second port</span></div>
</div><!-- fragment --><p><b>Range</b>: 1-65535 (0 is reserved)</p>
<h3><a class="anchor" id="autotoc_md36"></a>
DomainNumber</h3>
<p>Identifies a PTP domain for clock isolation (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 5.3.6):</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>DomainNumber = UInteger8;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Example usage</span></div>
<div class="line">DomainNumber default_domain = 0;  <span class="comment">// Default PTP domain</span></div>
<div class="line">DomainNumber custom_domain = 5;   <span class="comment">// Custom domain for isolation</span></div>
</div><!-- fragment --><p><b>Range</b>: 0-127 for default profile, 128-255 alternate domains</p>
<h2><a class="anchor" id="autotoc_md37"></a>
2.3 Timestamp</h2>
<p>PTP timestamp representation (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 5.3.3):</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Timestamp {</div>
<div class="line">    UInteger48 seconds;       <span class="comment">// Seconds since epoch (January 1, 1970)</span></div>
<div class="line">    UInteger32 nanoseconds;   <span class="comment">// Nanoseconds portion (0-999,999,999)</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Constructors</span></div>
<div class="line">    <span class="keyword">constexpr</span> Timestamp() noexcept;</div>
<div class="line">    constexpr Timestamp(UInteger64 sec, UInteger32 nsec) noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Operations</span></div>
<div class="line">    constexpr Timestamp operator+(const TimeInterval&amp; interval) const noexcept;</div>
<div class="line">    constexpr Timestamp operator-(const TimeInterval&amp; interval) const noexcept;</div>
<div class="line">    constexpr TimeInterval operator-(const Timestamp&amp; other) const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> operator&lt;(const Timestamp&amp; other) const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> operator&lt;=(const Timestamp&amp; other) const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> operator&gt;(const Timestamp&amp; other) const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> operator&gt;=(const Timestamp&amp; other) const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> operator==(const Timestamp&amp; other) const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> operator!=(const Timestamp&amp; other) const noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Conversion</span></div>
<div class="line">    UInteger64 toNanoseconds() const noexcept;</div>
<div class="line">    static Timestamp fromNanoseconds(UInteger64 ns) noexcept;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Example</b>: </p><div class="fragment"><div class="line"><span class="comment">// Get current time from HAL</span></div>
<div class="line">Timestamp t1 = callbacks.get_timestamp();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add 1 millisecond</span></div>
<div class="line">TimeInterval one_ms = TimeInterval::fromNanoseconds(1000000);</div>
<div class="line">Timestamp t2 = t1 + one_ms;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Calculate time difference</span></div>
<div class="line">TimeInterval elapsed = t2 - t1;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Elapsed: &quot;</span> &lt;&lt; elapsed.toNanoseconds() &lt;&lt; <span class="stringliteral">&quot; ns\n&quot;</span>;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md38"></a>
2.4 TimeInterval</h2>
<p>Time interval with nanosecond precision (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 5.3.2):</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>TimeInterval {</div>
<div class="line">    Integer64 scaled_nanoseconds;  <span class="comment">// Time in units of nanoseconds * 2^16</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Constructors</span></div>
<div class="line">    <span class="keyword">constexpr</span> TimeInterval() noexcept;</div>
<div class="line">    constexpr explicit TimeInterval(Integer64 scaled_ns) noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Conversion</span></div>
<div class="line">    constexpr <span class="keywordtype">double</span> toNanoseconds() const noexcept;</div>
<div class="line">    static constexpr TimeInterval fromNanoseconds(<span class="keywordtype">double</span> ns) noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Operations</span></div>
<div class="line">    constexpr TimeInterval operator+(const TimeInterval&amp; other) const noexcept;</div>
<div class="line">    constexpr TimeInterval operator-(const TimeInterval&amp; other) const noexcept;</div>
<div class="line">    constexpr TimeInterval operator-() const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> operator&lt;(const TimeInterval&amp; other) const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> operator&gt;(const TimeInterval&amp; other) const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> operator==(const TimeInterval&amp; other) const noexcept;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Note</b>: Scaled nanoseconds (2^16 units) allow sub-nanosecond precision for <a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588 compliance.</p>
<p><b>Example</b>: </p><div class="fragment"><div class="line"><span class="comment">// Create intervals</span></div>
<div class="line">TimeInterval offset = TimeInterval::fromNanoseconds(-500.5);  <span class="comment">// -500.5 ns</span></div>
<div class="line">TimeInterval delay = TimeInterval::fromNanoseconds(1234.75);  <span class="comment">// 1234.75 ns</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Operations</span></div>
<div class="line">TimeInterval total = offset + delay;  <span class="comment">// 734.25 ns</span></div>
<div class="line"><span class="keywordtype">double</span> ns = total.toNanoseconds();     <span class="comment">// Convert to double: 734.25</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md39"></a>
2.5 CorrectionField</h2>
<p>Correction field for timestamp adjustments (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 5.3.9):</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>CorrectionField {</div>
<div class="line">    UInteger64 value;  <span class="comment">// Correction in nanoseconds * 2^16</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Constructors</span></div>
<div class="line">    <span class="keyword">constexpr</span> CorrectionField() noexcept;</div>
<div class="line">    constexpr explicit CorrectionField(UInteger64 val) noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Conversion</span></div>
<div class="line">    constexpr <span class="keywordtype">double</span> toNanoseconds() const noexcept;</div>
<div class="line">    static constexpr CorrectionField fromNanoseconds(<span class="keywordtype">double</span> ns) noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Operations</span></div>
<div class="line">    constexpr CorrectionField&amp; operator+=(const CorrectionField&amp; other) noexcept;</div>
<div class="line">    constexpr CorrectionField operator&lt;&lt;(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> shift) const noexcept;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Usage</b>: Accumulates residence time and path delay corrections through transparent clocks.</p>
<h2><a class="anchor" id="autotoc_md40"></a>
2.6 Port States</h2>
<p>PTP port states (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 9.2.5):</p>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> PortState : UInteger8 {</div>
<div class="line">    Initializing  = 0x00,  <span class="comment">// Initial state during power-up</span></div>
<div class="line">    Faulty        = 0x01,  <span class="comment">// Port detected a fault</span></div>
<div class="line">    Disabled      = 0x02,  <span class="comment">// Port disabled by management</span></div>
<div class="line">    Listening     = 0x03,  <span class="comment">// Listening for Announce messages</span></div>
<div class="line">    PreMaster     = 0x04,  <span class="comment">// Before becoming Master</span></div>
<div class="line">    Master        = 0x05,  <span class="comment">// Acting as Master port</span></div>
<div class="line">    Passive       = 0x06,  <span class="comment">// Not selected by BMCA but receiving</span></div>
<div class="line">    Uncalibrated  = 0x07,  <span class="comment">// Slave receiving Sync, not yet synchronized</span></div>
<div class="line">    Slave         = 0x08   <span class="comment">// Synchronized Slave port</span></div>
<div class="line">};</div>
</div><!-- fragment --><p><b>State Transitions</b> (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Figure 9-1): </p><div class="fragment"><div class="line">Initializing → Listening → Uncalibrated → Slave (normal slave path)</div>
<div class="line">Initializing → Listening → PreMaster → Master (normal master path)</div>
<div class="line">Initializing → Listening → Passive (when not best master)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md41"></a>
2.7 Clock Types</h2>
<p>PTP clock types (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 6.5):</p>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> ClockType : UInteger8 {</div>
<div class="line">    Ordinary        = 0x00,  <span class="comment">// Single port clock (Section 6.5.2)</span></div>
<div class="line">    Boundary        = 0x01,  <span class="comment">// Multi-port clock (Section 6.5.3)</span></div>
<div class="line">    E2E_Transparent = 0x02,  <span class="comment">// End-to-End TC (Section 6.5.4)</span></div>
<div class="line">    P2P_Transparent = 0x03,  <span class="comment">// Peer-to-Peer TC (Section 6.5.5)</span></div>
<div class="line">    Management      = 0x04   <span class="comment">// Management node (Section 6.5.6)</span></div>
<div class="line">};</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md43"></a>
3. Clock State Machines</h1>
<h2><a class="anchor" id="autotoc_md44"></a>
3.1 Ordinary Clock</h2>
<p>Single-port PTP clock implementation (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 6.5.2):</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>OrdinaryClock {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Construction</span></div>
<div class="line">    <span class="keyword">explicit</span> OrdinaryClock(<span class="keyword">const</span> PortConfiguration&amp; port_config,</div>
<div class="line">                          <span class="keyword">const</span> StateCallbacks&amp; callbacks) <span class="keyword">noexcept</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Clock control</span></div>
<div class="line">    PTPResult&lt;void&gt; initialize() noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; start() noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; stop() noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Message processing</span></div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; process_message(uint8_t message_type,</div>
<div class="line">                                   const <span class="keywordtype">void</span>* message_data,</div>
<div class="line">                                   <span class="keywordtype">size_t</span> message_size,</div>
<div class="line">                                   const Timestamp&amp; rx_timestamp) noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Periodic processing (call every 125ms or configured interval)</span></div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; tick(const Timestamp&amp; current_time) noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// State queries</span></div>
<div class="line">    constexpr PtpPort&amp; get_port() noexcept;</div>
<div class="line">    constexpr const PtpPort&amp; get_port() const noexcept;</div>
<div class="line">    constexpr ClockType get_clock_type() const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> is_master() const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> is_slave() const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> is_synchronized() const noexcept;</div>
<div class="line">    constexpr const TimePropertiesDataSet&amp; get_time_properties_data_set() const noexcept;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Usage Example</b>: </p><div class="fragment"><div class="line"><span class="comment">// Configure port</span></div>
<div class="line">PortConfiguration config;</div>
<div class="line">config.port_number = 1;</div>
<div class="line">config.domain_number = 0;</div>
<div class="line">config.announce_interval = 1;  <span class="comment">// 2^1 = 2 seconds</span></div>
<div class="line">config.sync_interval = 0;      <span class="comment">// 2^0 = 1 second</span></div>
<div class="line">config.delay_req_interval = 0; <span class="comment">// 2^0 = 1 second</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Setup callbacks (HAL integration)</span></div>
<div class="line">StateCallbacks callbacks = {</div>
<div class="line">    .send_announce = my_send_announce,</div>
<div class="line">    .send_sync = my_send_sync,</div>
<div class="line">    .send_follow_up = my_send_follow_up,</div>
<div class="line">    .send_delay_req = my_send_delay_req,</div>
<div class="line">    .send_delay_resp = my_send_delay_resp,</div>
<div class="line">    .get_timestamp = my_get_timestamp,</div>
<div class="line">    .get_tx_timestamp = my_get_tx_timestamp,</div>
<div class="line">    .adjust_clock = my_adjust_clock,</div>
<div class="line">    .adjust_frequency = my_adjust_frequency,</div>
<div class="line">    .on_state_change = my_state_change_handler,</div>
<div class="line">    .on_fault = my_fault_handler</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create and initialize clock</span></div>
<div class="line">OrdinaryClock clock(config, callbacks);</div>
<div class="line"><span class="keyword">auto</span> result = clock.initialize();</div>
<div class="line"><span class="keywordflow">if</span> (result.is_success()) {</div>
<div class="line">    clock.start();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Main loop</span></div>
<div class="line"><span class="keywordflow">while</span> (running) {</div>
<div class="line">    Timestamp now = get_current_time();</div>
<div class="line">    clock.tick(now);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Process received messages</span></div>
<div class="line">    <span class="keywordflow">if</span> (message_received) {</div>
<div class="line">        clock.process_message(msg_type, msg_data, msg_size, rx_timestamp);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Check synchronization status</span></div>
<div class="line">    <span class="keywordflow">if</span> (clock.is_synchronized()) {</div>
<div class="line">        <span class="comment">// Clock is synchronized to master</span></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    usleep(1000);  <span class="comment">// 1ms sleep</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">clock.stop();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md45"></a>
3.2 PtpPort</h2>
<p>Single PTP port state machine (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 9.2):</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>PtpPort {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Construction</span></div>
<div class="line">    <span class="keyword">explicit</span> PtpPort(<span class="keyword">const</span> PortConfiguration&amp; config,</div>
<div class="line">                    <span class="keyword">const</span> StateCallbacks&amp; callbacks) <span class="keyword">noexcept</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// State machine control</span></div>
<div class="line">    PTPResult&lt;void&gt; initialize() noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; start() noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; stop() noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; process_event(StateEvent event) noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Message processing (non-blocking, bounded execution)</span></div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; process_announce(const AnnounceMessage&amp; message) noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; process_sync(const SyncMessage&amp; message,</div>
<div class="line">                                 const Timestamp&amp; rx_timestamp) noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; process_follow_up(const FollowUpMessage&amp; message) noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; process_delay_req(const DelayReqMessage&amp; message,</div>
<div class="line">                                     const Timestamp&amp; rx_timestamp) noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; process_delay_resp(const DelayRespMessage&amp; message) noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; process_pdelay_req(const PdelayReqMessage&amp; message,</div>
<div class="line">                                      const Timestamp&amp; rx_timestamp) noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; process_pdelay_resp(const PdelayRespMessage&amp; message,</div>
<div class="line">                                       const Timestamp&amp; rx_timestamp) noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; process_pdelay_resp_follow_up(</div>
<div class="line">        const PdelayRespFollowUpMessage&amp; message) noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; process_management(const ManagementMessage&amp; message,</div>
<div class="line">                                      uint8_t* response_buffer,</div>
<div class="line">                                      <span class="keywordtype">size_t</span>&amp; response_size) noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; process_signaling(const SignalingMessage&amp; message,</div>
<div class="line">                                     uint8_t* response_buffer,</div>
<div class="line">                                     <span class="keywordtype">size_t</span>&amp; response_size) noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Periodic processing (call at regular intervals)</span></div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; tick(const Timestamp&amp; current_time) noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// State queries (deterministic, read-only)</span></div>
<div class="line">    constexpr PortState get_state() const noexcept;</div>
<div class="line">    constexpr const PortIdentity&amp; get_identity() const noexcept;</div>
<div class="line">    constexpr const PortStatistics&amp; get_statistics() const noexcept;</div>
<div class="line">    constexpr const PortConfiguration&amp; get_configuration() const noexcept;</div>
<div class="line">    constexpr const CurrentDataSet&amp; get_current_data_set() const noexcept;</div>
<div class="line">    constexpr const ParentDataSet&amp; get_parent_data_set() const noexcept;</div>
<div class="line">    constexpr const TimePropertiesDataSet&amp; get_time_properties_data_set() const noexcept;</div>
<div class="line">    constexpr const DefaultDataSet&amp; get_default_data_set() const noexcept;</div>
<div class="line">    constexpr const PortDataSet&amp; get_port_data_set() const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> is_master() const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> is_slave() const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> is_synchronized() const noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Configuration updates</span></div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; set_announce_interval(uint8_t log_interval) noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; set_sync_interval(uint8_t log_interval) noexcept;</div>
<div class="line">    <span class="keywordtype">void</span> clear_statistics() noexcept;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>State Event Processing</b>: </p><div class="fragment"><div class="line"><span class="comment">// Process port enable event</span></div>
<div class="line">port.process_event(StateEvent::DESIGNATED_ENABLED);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Process BMCA recommended state</span></div>
<div class="line">port.process_event(StateEvent::RS_SLAVE);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Process timeout</span></div>
<div class="line">port.process_event(StateEvent::ANNOUNCE_RECEIPT_TIMEOUT);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md46"></a>
3.3 Boundary Clock</h2>
<p>Multi-port PTP clock (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 6.5.3):</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>BoundaryClock {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">size_t</span> MAX_PORTS = 8;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Construction</span></div>
<div class="line">    <span class="keyword">explicit</span> BoundaryClock(<span class="keyword">const</span> std::array&lt;PortConfiguration, MAX_PORTS&gt;&amp; port_configs,</div>
<div class="line">                          <span class="keywordtype">size_t</span> port_count,</div>
<div class="line">                          <span class="keyword">const</span> StateCallbacks&amp; callbacks) <span class="keyword">noexcept</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Clock control</span></div>
<div class="line">    PTPResult&lt;void&gt; initialize() noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; start() noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; stop() noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Message processing on specific port</span></div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; process_message(PortNumber port_number,</div>
<div class="line">                                   uint8_t message_type,</div>
<div class="line">                                   const <span class="keywordtype">void</span>* message_data,</div>
<div class="line">                                   <span class="keywordtype">size_t</span> message_size,</div>
<div class="line">                                   const Timestamp&amp; rx_timestamp) noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Periodic processing</span></div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; tick(const Timestamp&amp; current_time) noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// State queries</span></div>
<div class="line">    constexpr <span class="keywordtype">size_t</span> get_port_count() const noexcept;</div>
<div class="line">    const PtpPort* get_port(PortNumber port_number) const noexcept;</div>
<div class="line">    constexpr ClockType get_clock_type() const noexcept;</div>
<div class="line">    <span class="keywordtype">bool</span> has_master_port() const noexcept;</div>
<div class="line">    <span class="keywordtype">bool</span> has_slave_port() const noexcept;</div>
<div class="line">    <span class="keywordtype">bool</span> is_synchronized() const noexcept;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Usage Example</b>: </p><div class="fragment"><div class="line"><span class="comment">// Configure multiple ports</span></div>
<div class="line">std::array&lt;PortConfiguration, BoundaryClock::MAX_PORTS&gt; configs;</div>
<div class="line">configs[0].port_number = 1;</div>
<div class="line">configs[1].port_number = 2;</div>
<div class="line">configs[2].port_number = 3;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create boundary clock with 3 ports</span></div>
<div class="line">BoundaryClock bc(configs, 3, callbacks);</div>
<div class="line">bc.initialize();</div>
<div class="line">bc.start();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Process message on specific port</span></div>
<div class="line">bc.process_message(port_number, msg_type, msg_data, msg_size, rx_timestamp);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check if synchronized (has slave port synced to master)</span></div>
<div class="line"><span class="keywordflow">if</span> (bc.is_synchronized()) {</div>
<div class="line">    <span class="comment">// Boundary clock is synchronized</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md47"></a>
3.4 Transparent Clock</h2>
<p>Residence time correction clock (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Sections 6.5.4, 6.5.5):</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>TransparentClock {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">size_t</span> MAX_PORTS = 16;</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">enum class</span> TransparentType : uint8_t {</div>
<div class="line">        END_TO_END   = 0x00,  <span class="comment">// E2E Transparent Clock</span></div>
<div class="line">        PEER_TO_PEER = 0x01   <span class="comment">// P2P Transparent Clock</span></div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Construction</span></div>
<div class="line">    <span class="keyword">explicit</span> TransparentClock(TransparentType type,</div>
<div class="line">                             <span class="keyword">const</span> std::array&lt;PortConfiguration, MAX_PORTS&gt;&amp; port_configs,</div>
<div class="line">                             <span class="keywordtype">size_t</span> port_count,</div>
<div class="line">                             <span class="keyword">const</span> StateCallbacks&amp; callbacks) <span class="keyword">noexcept</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Clock control</span></div>
<div class="line">    PTPResult&lt;void&gt; initialize() noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; start() noexcept;</div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; stop() noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Message forwarding with residence time correction</span></div>
<div class="line">    PTPResult&lt;<span class="keywordtype">void</span>&gt; forward_message(PortNumber ingress_port,</div>
<div class="line">                                   PortNumber egress_port,</div>
<div class="line">                                   <span class="keywordtype">void</span>* message_data,</div>
<div class="line">                                   <span class="keywordtype">size_t</span> message_size,</div>
<div class="line">                                   const Timestamp&amp; ingress_timestamp,</div>
<div class="line">                                   const Timestamp&amp; egress_timestamp) noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// State queries</span></div>
<div class="line">    constexpr TransparentType get_transparent_type() const noexcept;</div>
<div class="line">    constexpr ClockType get_clock_type() const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">size_t</span> get_port_count() const noexcept;</div>
<div class="line">};</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md49"></a>
4. Message Handling</h1>
<h2><a class="anchor" id="autotoc_md50"></a>
4.1 Message Types</h2>
<p><a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 message types (Section 13.3.2):</p>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> MessageType : uint8_t {</div>
<div class="line">    Sync                 = 0x00,  <span class="comment">// Synchronization message</span></div>
<div class="line">    Delay_Req            = 0x01,  <span class="comment">// Delay request</span></div>
<div class="line">    Pdelay_Req           = 0x02,  <span class="comment">// Peer delay request</span></div>
<div class="line">    Pdelay_Resp          = 0x03,  <span class="comment">// Peer delay response</span></div>
<div class="line">    Follow_Up            = 0x08,  <span class="comment">// Follow up message</span></div>
<div class="line">    Delay_Resp           = 0x09,  <span class="comment">// Delay response</span></div>
<div class="line">    Pdelay_Resp_Follow_Up = 0x0A, <span class="comment">// Peer delay response follow up</span></div>
<div class="line">    Announce             = 0x0B,  <span class="comment">// Announce message</span></div>
<div class="line">    Signaling            = 0x0C,  <span class="comment">// Signaling message</span></div>
<div class="line">    Management           = 0x0D   <span class="comment">// Management message</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md51"></a>
4.2 Common Message Header</h2>
<p>All PTP messages share common header (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 13.3):</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>PTPHeader {</div>
<div class="line">    uint8_t messageType;           <span class="comment">// 4 bits messageType + 4 bits transportSpecific</span></div>
<div class="line">    uint8_t versionPTP;           <span class="comment">// 4 bits reserved + 4 bits versionPTP (0x2)</span></div>
<div class="line">    uint16_t messageLength;        <span class="comment">// Total message length in bytes</span></div>
<div class="line">    uint8_t domainNumber;          <span class="comment">// PTP domain number</span></div>
<div class="line">    uint8_t reserved1;             <span class="comment">// Reserved field</span></div>
<div class="line">    uint16_t flagField;            <span class="comment">// Flags (alternateMaster, twoStep, etc.)</span></div>
<div class="line">    CorrectionField correctionField; <span class="comment">// Correction value</span></div>
<div class="line">    uint32_t reserved2;            <span class="comment">// Reserved field</span></div>
<div class="line">    ClockIdentity sourcePortIdentity; <span class="comment">// Source clock + port</span></div>
<div class="line">    SequenceId sequenceId;         <span class="comment">// Message sequence ID</span></div>
<div class="line">    uint8_t controlField;          <span class="comment">// Deprecated, always 0xFF</span></div>
<div class="line">    uint8_t logMessageInterval;    <span class="comment">// Message transmission interval</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md52"></a>
4.3 Announce Message</h2>
<p>Master clock quality advertisement (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 13.5):</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>AnnounceMessage {</div>
<div class="line">    PTPHeader header;</div>
<div class="line">    Timestamp originTimestamp;     <span class="comment">// Origin timestamp</span></div>
<div class="line">    int16_t currentUtcOffset;      <span class="comment">// UTC offset in seconds</span></div>
<div class="line">    uint8_t reserved;</div>
<div class="line">    uint8_t grandmasterPriority1;  <span class="comment">// GM priority 1 (0-255)</span></div>
<div class="line">    ClockQuality grandmasterClockQuality; <span class="comment">// GM clock quality</span></div>
<div class="line">    uint8_t grandmasterPriority2;  <span class="comment">// GM priority 2 (0-255)</span></div>
<div class="line">    ClockIdentity grandmasterIdentity; <span class="comment">// GM clock ID</span></div>
<div class="line">    uint16_t stepsRemoved;         <span class="comment">// Hops from GM</span></div>
<div class="line">    uint8_t timeSource;            <span class="comment">// Time source type</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Methods</span></div>
<div class="line">    PTPResult&lt;void&gt; parse(<span class="keyword">const</span> uint8_t* buffer, <span class="keywordtype">size_t</span> buffer_size) <span class="keyword">noexcept</span>;</div>
<div class="line">    PTPResult&lt;size_t&gt; serialize(uint8_t* buffer, <span class="keywordtype">size_t</span> buffer_size) <span class="keyword">const</span> <span class="keyword">noexcept</span>;</div>
<div class="line">    PTPResult&lt;void&gt; validate() const noexcept;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Usage Example</b>: </p><div class="fragment"><div class="line"><span class="comment">// Parse received Announce message</span></div>
<div class="line">AnnounceMessage announce;</div>
<div class="line"><span class="keyword">auto</span> result = announce.parse(rx_buffer, rx_size);</div>
<div class="line"><span class="keywordflow">if</span> (result.is_success()) {</div>
<div class="line">    <span class="comment">// Process announce message</span></div>
<div class="line">    port.process_announce(announce);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Access announce data</span></div>
<div class="line">    uint8_t priority1 = announce.grandmasterPriority1;</div>
<div class="line">    ClockClass clock_class = announce.grandmasterClockQuality.clockClass;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md53"></a>
4.4 Sync Message</h2>
<p>Time synchronization message (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 13.6):</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>SyncMessage {</div>
<div class="line">    PTPHeader header;</div>
<div class="line">    Timestamp originTimestamp;  <span class="comment">// Origin timestamp (T1)</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Methods</span></div>
<div class="line">    PTPResult&lt;void&gt; parse(<span class="keyword">const</span> uint8_t* buffer, <span class="keywordtype">size_t</span> buffer_size) <span class="keyword">noexcept</span>;</div>
<div class="line">    PTPResult&lt;size_t&gt; serialize(uint8_t* buffer, <span class="keywordtype">size_t</span> buffer_size) <span class="keyword">const</span> <span class="keyword">noexcept</span>;</div>
<div class="line">    PTPResult&lt;void&gt; validate() const noexcept;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Two-Step Sync Process</b>: </p><div class="fragment"><div class="line"><span class="comment">// Step 1: Process Sync message (approximate T1)</span></div>
<div class="line">SyncMessage sync;</div>
<div class="line">sync.parse(rx_buffer, rx_size);</div>
<div class="line">Timestamp t2 = get_rx_timestamp();  <span class="comment">// Local receive time</span></div>
<div class="line">port.process_sync(sync, t2);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Step 2: Process Follow_Up message (precise T1)</span></div>
<div class="line">FollowUpMessage follow_up;</div>
<div class="line">follow_up.parse(rx_buffer2, rx_size2);</div>
<div class="line">port.process_follow_up(follow_up);</div>
<div class="line"><span class="comment">// Now offset calculation can proceed with precise T1</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md54"></a>
4.5 Delay_Req and Delay_Resp Messages</h2>
<p>End-to-end delay measurement (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 13.7, 13.8):</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>DelayReqMessage {</div>
<div class="line">    PTPHeader header;</div>
<div class="line">    Timestamp originTimestamp;  <span class="comment">// Delay_Req transmit time (T3)</span></div>
<div class="line">    </div>
<div class="line">    PTPResult&lt;void&gt; parse(<span class="keyword">const</span> uint8_t* buffer, <span class="keywordtype">size_t</span> buffer_size) <span class="keyword">noexcept</span>;</div>
<div class="line">    PTPResult&lt;size_t&gt; serialize(uint8_t* buffer, <span class="keywordtype">size_t</span> buffer_size) <span class="keyword">const</span> <span class="keyword">noexcept</span>;</div>
<div class="line">    PTPResult&lt;void&gt; validate() const noexcept;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">struct DelayRespMessage {</div>
<div class="line">    PTPHeader header;</div>
<div class="line">    Timestamp receiveTimestamp;     <span class="comment">// Master received Delay_Req at T4</span></div>
<div class="line">    PortIdentity requestingPortIdentity; <span class="comment">// Port that sent Delay_Req</span></div>
<div class="line">    </div>
<div class="line">    PTPResult&lt;void&gt; parse(<span class="keyword">const</span> uint8_t* buffer, <span class="keywordtype">size_t</span> buffer_size) <span class="keyword">noexcept</span>;</div>
<div class="line">    PTPResult&lt;size_t&gt; serialize(uint8_t* buffer, <span class="keywordtype">size_t</span> buffer_size) <span class="keyword">const</span> <span class="keyword">noexcept</span>;</div>
<div class="line">    PTPResult&lt;void&gt; validate() const noexcept;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Delay Request-Response Mechanism</b>: </p><div class="fragment"><div class="line"><span class="comment">// Slave sends Delay_Req</span></div>
<div class="line">DelayReqMessage delay_req;</div>
<div class="line">delay_req.header.sequenceId = seq_id++;</div>
<div class="line">Timestamp t3 = get_tx_timestamp();</div>
<div class="line">delay_req.originTimestamp = t3;</div>
<div class="line">send_delay_req(delay_req);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Master responds with Delay_Resp</span></div>
<div class="line"><span class="comment">// (containing T4 = time master received Delay_Req)</span></div>
<div class="line">DelayRespMessage delay_resp;</div>
<div class="line">delay_resp.parse(rx_buffer, rx_size);</div>
<div class="line">Timestamp t4 = delay_resp.receiveTimestamp;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Now slave can calculate mean path delay:</span></div>
<div class="line"><span class="comment">// mean_path_delay = ((T2-T1) - (T4-T3)) / 2</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md56"></a>
5. Data Sets</h1>
<p><a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 defines multiple data sets to maintain clock state (Section 8.2).</p>
<h2><a class="anchor" id="autotoc_md57"></a>
5.1 Default Data Set</h2>
<p>Static clock configuration (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 8.2.1):</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>DefaultDataSet {</div>
<div class="line">    <span class="keywordtype">bool</span> twoStepFlag;                  <span class="comment">// TRUE = two-step sync</span></div>
<div class="line">    ClockIdentity clockIdentity;       <span class="comment">// 64-bit unique clock ID</span></div>
<div class="line">    uint16_t numberPorts;              <span class="comment">// Total PTP ports</span></div>
<div class="line">    ClockQuality clockQuality;         <span class="comment">// Clock quality characteristics</span></div>
<div class="line">    uint8_t priority1;                 <span class="comment">// BMCA priority 1 (0-255, default 128)</span></div>
<div class="line">    uint8_t priority2;                 <span class="comment">// BMCA priority 2 (0-255, default 128)</span></div>
<div class="line">    uint8_t domainNumber;              <span class="comment">// PTP domain (0-127)</span></div>
<div class="line">    <span class="keywordtype">bool</span> slaveOnly;                    <span class="comment">// TRUE = can never be Master</span></div>
<div class="line">};</div>
</div><!-- fragment --><p><b>BMCA Usage</b>:</p><ul>
<li><code>priority1</code> and <code>priority2</code> are compared first in BMCA</li>
<li><code>clockQuality</code> determines clock suitability</li>
<li><code>clockIdentity</code> is final tiebreaker</li>
</ul>
<p><b>Example</b>: </p><div class="fragment"><div class="line"><span class="comment">// Get default data set</span></div>
<div class="line"><span class="keyword">const</span> DefaultDataSet&amp; defaults = port.get_default_data_set();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Configure higher priority (lower value = higher priority)</span></div>
<div class="line">defaults.priority1 = 100;  <span class="comment">// Higher priority than default 128</span></div>
<div class="line">defaults.priority2 = 100;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set clock quality</span></div>
<div class="line">defaults.clockQuality.clockClass = 248;      <span class="comment">// Application-specific</span></div>
<div class="line">defaults.clockQuality.clockAccuracy = 0x20;  <span class="comment">// 25 ns accuracy</span></div>
<div class="line">defaults.clockQuality.offsetScaledLogVariance = 0x4E5D; <span class="comment">// Allan variance</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md58"></a>
5.2 Current Data Set</h2>
<p>Dynamic synchronization state (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 8.2.2):</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>CurrentDataSet {</div>
<div class="line">    uint16_t stepsRemoved;          <span class="comment">// Hops from grandmaster</span></div>
<div class="line">    TimeInterval offsetFromMaster;  <span class="comment">// Clock offset from master</span></div>
<div class="line">    TimeInterval meanPathDelay;     <span class="comment">// Mean propagation delay</span></div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Usage</b>: </p><div class="fragment"><div class="line"><span class="keyword">const</span> CurrentDataSet&amp; current = port.get_current_data_set();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check synchronization quality</span></div>
<div class="line"><span class="keywordflow">if</span> (std::abs(current.offsetFromMaster.toNanoseconds()) &lt; 100.0) {</div>
<div class="line">    <span class="comment">// Synchronized within 100 ns</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check network topology</span></div>
<div class="line"><span class="keywordflow">if</span> (current.stepsRemoved &lt; 3) {</div>
<div class="line">    <span class="comment">// Close to grandmaster (&lt; 3 hops)</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md59"></a>
5.3 Parent Data Set</h2>
<p>Information about master clock (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 8.2.3):</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ParentDataSet {</div>
<div class="line">    PortIdentity parentPortIdentity;         <span class="comment">// Parent clock + port</span></div>
<div class="line">    <span class="keywordtype">bool</span> parentStats;                        <span class="comment">// Parent statistics valid</span></div>
<div class="line">    uint16_t observedParentOffsetScaledLogVariance;</div>
<div class="line">    int32_t observedParentClockPhaseChangeRate;</div>
<div class="line">    ClockIdentity grandmasterIdentity;       <span class="comment">// GM clock ID</span></div>
<div class="line">    ClockQuality grandmasterClockQuality;    <span class="comment">// GM clock quality</span></div>
<div class="line">    uint8_t grandmasterPriority1;            <span class="comment">// GM priority 1</span></div>
<div class="line">    uint8_t grandmasterPriority2;            <span class="comment">// GM priority 2</span></div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Usage</b>: </p><div class="fragment"><div class="line"><span class="keyword">const</span> ParentDataSet&amp; parent = port.get_parent_data_set();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check grandmaster identity</span></div>
<div class="line"><span class="keywordflow">if</span> (memcmp(parent.grandmasterIdentity.data(), expected_gm.data(), 8) == 0) {</div>
<div class="line">    <span class="comment">// Synchronized to expected grandmaster</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check grandmaster quality</span></div>
<div class="line"><span class="keywordflow">if</span> (parent.grandmasterClockQuality.clockClass &lt;= 127) {</div>
<div class="line">    <span class="comment">// Grandmaster has external time source (GPS, etc.)</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md60"></a>
5.4 Time Properties Data Set</h2>
<p>Time characteristics from grandmaster (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 8.2.4):</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>TimePropertiesDataSet {</div>
<div class="line">    int16_t currentUtcOffset;       <span class="comment">// UTC offset in seconds</span></div>
<div class="line">    <span class="keywordtype">bool</span> currentUtcOffsetValid;     <span class="comment">// TRUE if UTC offset is valid</span></div>
<div class="line">    <span class="keywordtype">bool</span> leap59;                    <span class="comment">// TRUE if 59-second minute</span></div>
<div class="line">    <span class="keywordtype">bool</span> leap61;                    <span class="comment">// TRUE if 61-second minute</span></div>
<div class="line">    <span class="keywordtype">bool</span> ptpTimescale;              <span class="comment">// TRUE if PTP timescale</span></div>
<div class="line">    <span class="keywordtype">bool</span> timeTraceable;             <span class="comment">// TRUE if time traceable to reference</span></div>
<div class="line">    <span class="keywordtype">bool</span> frequencyTraceable;        <span class="comment">// TRUE if frequency traceable</span></div>
<div class="line">    uint8_t timeSource;             <span class="comment">// Time source type (GPS, etc.)</span></div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Usage</b>: </p><div class="fragment"><div class="line"><span class="keyword">const</span> TimePropertiesDataSet&amp; time_props = port.get_time_properties_data_set();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Convert PTP time to UTC</span></div>
<div class="line"><span class="keywordflow">if</span> (time_props.currentUtcOffsetValid) {</div>
<div class="line">    Timestamp ptp_time = get_ptp_time();</div>
<div class="line">    Timestamp utc_time = ptp_time - TimeInterval::fromNanoseconds(</div>
<div class="line">        time_props.currentUtcOffset * 1e9);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check time source quality</span></div>
<div class="line"><span class="keywordflow">if</span> (time_props.timeSource == 0x20) {  <span class="comment">// GPS time source</span></div>
<div class="line">    <span class="comment">// High-quality time source</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md61"></a>
5.5 Port Data Set</h2>
<p>Per-port configuration (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 8.2.5):</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>PortDataSet {</div>
<div class="line">    PortIdentity port_identity;</div>
<div class="line">    PortState port_state;</div>
<div class="line">    uint8_t log_min_delay_req_interval;</div>
<div class="line">    TimeInterval peer_mean_path_delay;</div>
<div class="line">    uint8_t log_announce_interval;</div>
<div class="line">    uint8_t announce_receipt_timeout;</div>
<div class="line">    uint8_t log_sync_interval;</div>
<div class="line">    <span class="keywordtype">bool</span> delay_mechanism;  <span class="comment">// false = E2E, true = P2P</span></div>
<div class="line">    uint8_t log_min_pdelay_req_interval;</div>
<div class="line">    uint8_t version_number;</div>
<div class="line">};</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md63"></a>
6. Hardware Abstraction Layer (HAL)</h1>
<h2><a class="anchor" id="autotoc_md64"></a>
6.1 State Callbacks</h2>
<p>Hardware abstraction via function pointers (deterministic, non-blocking):</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>StateCallbacks {</div>
<div class="line">    <span class="comment">// Message transmission (must be non-blocking)</span></div>
<div class="line">    PTPError (*send_announce)(<span class="keyword">const</span> AnnounceMessage&amp; msg);</div>
<div class="line">    PTPError (*send_sync)(<span class="keyword">const</span> SyncMessage&amp; msg);</div>
<div class="line">    PTPError (*send_follow_up)(<span class="keyword">const</span> FollowUpMessage&amp; msg);</div>
<div class="line">    PTPError (*send_delay_req)(<span class="keyword">const</span> DelayReqMessage&amp; msg);</div>
<div class="line">    PTPError (*send_delay_resp)(<span class="keyword">const</span> DelayRespMessage&amp; msg);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Timestamping (must be deterministic)</span></div>
<div class="line">    Timestamp (*get_timestamp)();</div>
<div class="line">    PTPError (*get_tx_timestamp)(uint16_t sequence_id, Timestamp* timestamp);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Hardware control (bounded execution time)</span></div>
<div class="line">    PTPError (*adjust_clock)(int64_t adjustment_ns);</div>
<div class="line">    PTPError (*adjust_frequency)(<span class="keywordtype">double</span> ppb_adjustment);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Event notification</span></div>
<div class="line">    void (*on_state_change)(PortState old_state, PortState new_state);</div>
<div class="line">    void (*on_fault)(<span class="keyword">const</span> <span class="keywordtype">char</span>* fault_description);</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md65"></a>
6.2 HAL Implementation Example</h2>
<div class="fragment"><div class="line"><span class="comment">// Implement message transmission</span></div>
<div class="line"><span class="keyword">static</span> PTPError my_send_sync(<span class="keyword">const</span> SyncMessage&amp; msg) {</div>
<div class="line">    uint8_t buffer[128];</div>
<div class="line">    <span class="keyword">auto</span> result = msg.serialize(buffer, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line">    <span class="keywordflow">if</span> (!result.is_success()) {</div>
<div class="line">        <span class="keywordflow">return</span> PTPError::SERIALIZATION_FAILED;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">size_t</span> msg_size = result.unwrap();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Call platform-specific network send</span></div>
<div class="line">    <span class="keywordtype">int</span> ret = platform_send_ethernet(buffer, msg_size);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> PTPError::NETWORK_ERROR;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> PTPError::SUCCESS;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Implement timestamping</span></div>
<div class="line"><span class="keyword">static</span> Timestamp my_get_timestamp() {</div>
<div class="line">    <span class="comment">// Read hardware timestamp counter</span></div>
<div class="line">    uint64_t ns = platform_read_timestamp_counter();</div>
<div class="line">    <span class="keywordflow">return</span> Timestamp::fromNanoseconds(ns);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_enumeration" href="../../d4/d6d/namespaceIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types.html#a00e18309a07f588272cc6fbba1779af5">PTPError</a> my_get_tx_timestamp(uint16_t sequence_id, Timestamp* timestamp) {</div>
<div class="line">    <span class="comment">// Get hardware TX timestamp for specific message</span></div>
<div class="line">    uint64_t ns;</div>
<div class="line">    <span class="keywordtype">int</span> ret = platform_get_tx_timestamp(sequence_id, &amp;ns);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> PTPError::TIMESTAMP_UNAVAILABLE;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    *timestamp = Timestamp::fromNanoseconds(ns);</div>
<div class="line">    <span class="keywordflow">return</span> PTPError::SUCCESS;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Implement clock adjustment</span></div>
<div class="line"><span class="keyword">static</span> <a class="code hl_enumeration" href="../../d4/d6d/namespaceIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types.html#a00e18309a07f588272cc6fbba1779af5">PTPError</a> my_adjust_clock(int64_t adjustment_ns) {</div>
<div class="line">    <span class="comment">// Apply clock offset adjustment</span></div>
<div class="line">    <span class="keywordtype">int</span> ret = platform_adjust_clock(adjustment_ns);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> PTPError::HARDWARE_ERROR;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> PTPError::SUCCESS;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_enumeration" href="../../d4/d6d/namespaceIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types.html#a00e18309a07f588272cc6fbba1779af5">PTPError</a> my_adjust_frequency(<span class="keywordtype">double</span> ppb_adjustment) {</div>
<div class="line">    <span class="comment">// Apply frequency adjustment</span></div>
<div class="line">    <span class="keywordtype">int</span> ret = platform_adjust_frequency(ppb_adjustment);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">        <span class="keywordflow">return</span> PTPError::HARDWARE_ERROR;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> PTPError::SUCCESS;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Event handlers</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> my_state_change_handler(PortState old_state, PortState new_state) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Port state changed: %d -&gt; %d\n&quot;</span>, (<span class="keywordtype">int</span>)old_state, (<span class="keywordtype">int</span>)new_state);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> my_fault_handler(<span class="keyword">const</span> <span class="keywordtype">char</span>* fault_description) {</div>
<div class="line">    fprintf(stderr, <span class="stringliteral">&quot;PTP Fault: %s\n&quot;</span>, fault_description);</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types_html_a00e18309a07f588272cc6fbba1779af5"><div class="ttname"><a href="../../d4/d6d/namespaceIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types.html#a00e18309a07f588272cc6fbba1779af5">IEEE::_1588::PTP::_2019::Types::PTPError</a></div><div class="ttdeci">PTPError</div><div class="ttdoc">Deterministic error codes for PTP operations.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/de3/types_8hpp_source.html#l00481">types.hpp:481</a></div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md67"></a>
7. Best Master Clock Algorithm (BMCA)</h1>
<h2><a class="anchor" id="autotoc_md68"></a>
7.1 BMCA Decision</h2>
<p><a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section 9.3 comparison algorithm:</p>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> BMCADecision : uint8_t {</div>
<div class="line">    BETTER_MASTER       = 0x00,  <span class="comment">// Foreign master is better</span></div>
<div class="line">    BETTER_BY_TOPOLOGY  = 0x01,  <span class="comment">// Foreign master better by topology</span></div>
<div class="line">    SAME_MASTER         = 0x02,  <span class="comment">// Same master clock</span></div>
<div class="line">    WORSE_BY_TOPOLOGY   = 0x03,  <span class="comment">// Foreign master worse by topology</span></div>
<div class="line">    WORSE_MASTER        = 0x04   <span class="comment">// Foreign master is worse</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md69"></a>
7.2 BMCA Comparison Steps</h2>
<p><b>Dataset Comparison Order</b> (<a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Figure 27):</p>
<ol type="1">
<li><b>Priority1</b>: Compare <code>grandmasterPriority1</code> (lower wins)</li>
<li><b>ClockClass</b>: Compare <code>clockClass</code> (lower wins)</li>
<li><b>ClockAccuracy</b>: Compare <code>clockAccuracy</code> (lower wins)</li>
<li><b>OffsetScaledLogVariance</b>: Compare variance (lower wins)</li>
<li><b>Priority2</b>: Compare <code>grandmasterPriority2</code> (lower wins)</li>
<li><b>ClockIdentity</b>: Compare GM identity (lower wins)</li>
<li><b>StepsRemoved</b>: Compare hops (lower wins)</li>
<li><b>PortIdentity</b>: Compare sender identity (tiebreaker)</li>
</ol>
<p><b>Example</b>: </p><div class="fragment"><div class="line"><span class="comment">// BMCA automatically runs during tick() processing</span></div>
<div class="line"><span class="comment">// Get BMCA result via port state</span></div>
<div class="line"><span class="keywordflow">if</span> (port.is_master()) {</div>
<div class="line">    <span class="comment">// This port won BMCA election, became Master</span></div>
<div class="line">} <span class="keywordflow">else</span> <span class="keywordflow">if</span> (port.is_slave()) {</div>
<div class="line">    <span class="comment">// Another port won BMCA, this port is Slave</span></div>
<div class="line">} <span class="keywordflow">else</span> <span class="keywordflow">if</span> (port.get_state() == PortState::Passive) {</div>
<div class="line">    <span class="comment">// Port is Passive (not best, but listening)</span></div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md71"></a>
8. Error Handling</h1>
<h2><a class="anchor" id="autotoc_md72"></a>
8.1 PTPError Enum</h2>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> PTPError : uint8_t {</div>
<div class="line">    SUCCESS                  = 0x00,  <span class="comment">// Operation succeeded</span></div>
<div class="line">    INVALID_LENGTH           = 0x01,  <span class="comment">// Invalid message/buffer length</span></div>
<div class="line">    INVALID_MESSAGE_TYPE     = 0x02,  <span class="comment">// Unknown message type</span></div>
<div class="line">    INVALID_VERSION          = 0x03,  <span class="comment">// Unsupported PTP version</span></div>
<div class="line">    INVALID_DOMAIN           = 0x04,  <span class="comment">// Invalid domain number</span></div>
<div class="line">    TIMESTAMP_UNAVAILABLE    = 0x05,  <span class="comment">// Timestamp not available</span></div>
<div class="line">    NETWORK_ERROR            = 0x06,  <span class="comment">// Network transmission error</span></div>
<div class="line">    HARDWARE_ERROR           = 0x07,  <span class="comment">// Hardware access error</span></div>
<div class="line">    SERIALIZATION_FAILED     = 0x08,  <span class="comment">// Message serialization failed</span></div>
<div class="line">    PARSE_FAILED             = 0x09,  <span class="comment">// Message parsing failed</span></div>
<div class="line">    STATE_MACHINE_ERROR      = 0x0A,  <span class="comment">// Invalid state transition</span></div>
<div class="line">    RESOURCE_UNAVAILABLE     = 0x0B,  <span class="comment">// Resource not available</span></div>
<div class="line">    TIMEOUT                  = 0x0C,  <span class="comment">// Operation timed out</span></div>
<div class="line">    NOT_INITIALIZED          = 0x0D,  <span class="comment">// Component not initialized</span></div>
<div class="line">    ALREADY_INITIALIZED      = 0x0E,  <span class="comment">// Component already initialized</span></div>
<div class="line">    INVALID_PARAMETER        = 0x0F   <span class="comment">// Invalid parameter value</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md73"></a>
8.2 PTPResult Template</h2>
<p>Result monad for error handling (no exceptions):</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">class </span>PTPResult {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Success/failure factory methods</span></div>
<div class="line">    <span class="keyword">static</span> PTPResult&lt;T&gt; success(T value) <span class="keyword">noexcept</span>;</div>
<div class="line">    <span class="keyword">static</span> PTPResult&lt;void&gt; success() noexcept;  <span class="comment">// Specialization for void</span></div>
<div class="line">    static PTPResult&lt;T&gt; failure(PTPError error) noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Query result</span></div>
<div class="line">    constexpr <span class="keywordtype">bool</span> is_success() const noexcept;</div>
<div class="line">    constexpr <span class="keywordtype">bool</span> is_failure() const noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Access value (only if success)</span></div>
<div class="line">    constexpr const T&amp; unwrap() const noexcept;</div>
<div class="line">    constexpr T&amp; unwrap() noexcept;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Access error (only if failure)</span></div>
<div class="line">    constexpr PTPError error() const noexcept;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Usage Example</b>: </p><div class="fragment"><div class="line"><span class="comment">// Function returning PTPResult</span></div>
<div class="line">PTPResult&lt;Timestamp&gt; get_current_time() noexcept {</div>
<div class="line">    <span class="keywordflow">if</span> (hardware_available()) {</div>
<div class="line">        Timestamp ts = read_hardware_timestamp();</div>
<div class="line">        <span class="keywordflow">return</span> PTPResult&lt;Timestamp&gt;::success(ts);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">return</span> PTPResult&lt;Timestamp&gt;::failure(PTPError::HARDWARE_ERROR);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check result and handle error</span></div>
<div class="line"><span class="keyword">auto</span> result = get_current_time();</div>
<div class="line"><span class="keywordflow">if</span> (result.is_success()) {</div>
<div class="line">    Timestamp ts = result.unwrap();</div>
<div class="line">    <span class="comment">// Use timestamp</span></div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code hl_enumeration" href="../../d4/d6d/namespaceIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types.html#a00e18309a07f588272cc6fbba1779af5">PTPError</a> err = result.error();</div>
<div class="line">    <span class="comment">// Handle error</span></div>
<div class="line">    <span class="keywordflow">if</span> (err == PTPError::HARDWARE_ERROR) {</div>
<div class="line">        <span class="comment">// Recover or report error</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md75"></a>
9. Usage Examples</h1>
<h2><a class="anchor" id="autotoc_md76"></a>
9.1 Basic Slave Clock</h2>
<p>Complete example of PTP slave clock:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../dd/dc5/clocks_8hpp.html">clocks.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../dd/de3/types_8hpp.html">IEEE/1588/PTP/2019/types.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../dd/de4/namespaceIEEE_1_1__1588_1_1PTP_1_1__2019.html">IEEE::_1588::PTP::_2019</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../dc/dd4/namespaceIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks.html">IEEE::_1588::PTP::_2019::Clocks</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// HAL implementations (platform-specific)</span></div>
<div class="line"><span class="keyword">extern</span> <a class="code hl_enumeration" href="../../d4/d6d/namespaceIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types.html#a00e18309a07f588272cc6fbba1779af5">PTPError</a> platform_send_message(<span class="keyword">const</span> uint8_t* data, <span class="keywordtype">size_t</span> size);</div>
<div class="line"><span class="keyword">extern</span> <a class="code hl_struct" href="../../d4/d6e/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types_1_1Timestamp.html">Timestamp</a> platform_get_timestamp();</div>
<div class="line"><span class="keyword">extern</span> <a class="code hl_enumeration" href="../../d4/d6d/namespaceIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types.html#a00e18309a07f588272cc6fbba1779af5">PTPError</a> platform_adjust_clock(int64_t adjustment_ns);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Callback implementations</span></div>
<div class="line"><span class="keyword">static</span> <a class="code hl_enumeration" href="../../d4/d6d/namespaceIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types.html#a00e18309a07f588272cc6fbba1779af5">PTPError</a> send_delay_req(<span class="keyword">const</span> <a class="code hl_struct" href="../../d0/de3/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1PTPMessage.html">DelayReqMessage</a>&amp; msg) {</div>
<div class="line">    uint8_t buffer[128];</div>
<div class="line">    <span class="keyword">auto</span> result = msg.serialize(buffer, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line">    <span class="keywordflow">if</span> (!result.is_success()) <span class="keywordflow">return</span> PTPError::SERIALIZATION_FAILED;</div>
<div class="line">    <span class="keywordflow">return</span> platform_send_message(buffer, result.unwrap());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ... (other callbacks similar)</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Configure slave port</span></div>
<div class="line">    <a class="code hl_struct" href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html">PortConfiguration</a> config;</div>
<div class="line">    config.<a class="code hl_variable" href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#a0dfd4f47e3ad115479bd6e6a1dcdf081">port_number</a> = 1;</div>
<div class="line">    config.<a class="code hl_variable" href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#aee1d6d3ff0bb368d16fbb14b32cb5dbd">domain_number</a> = 0;</div>
<div class="line">    config.<a class="code hl_variable" href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#af7f20c773006a8150a5a89f6b81f8a82">announce_interval</a> = 1;</div>
<div class="line">    config.<a class="code hl_variable" href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#ae1b43b1516202d34b9f3e0d0bf5f1da3">sync_interval</a> = 0;</div>
<div class="line">    config.<a class="code hl_variable" href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#aa764c35035684c70a5b8bcf1e0e5bc52">delay_req_interval</a> = 0;</div>
<div class="line">    config.<a class="code hl_variable" href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#a8545975661ddb1dc889b2cfb8c352027">announce_receipt_timeout</a> = 3;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Setup callbacks</span></div>
<div class="line">    <a class="code hl_struct" href="../../d4/dea/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1StateCallbacks.html">StateCallbacks</a> callbacks = {</div>
<div class="line">        .<a class="code hl_variable" href="../../d4/dea/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1StateCallbacks.html#ae7369a8c4ad5b9c9220267a258aaf34a">send_announce</a> = <span class="keyword">nullptr</span>,  <span class="comment">// Slave doesn&#39;t send Announce</span></div>
<div class="line">        .send_sync = <span class="keyword">nullptr</span>,      <span class="comment">// Slave doesn&#39;t send Sync</span></div>
<div class="line">        .send_follow_up = <span class="keyword">nullptr</span>,</div>
<div class="line">        .send_delay_req = send_delay_req,</div>
<div class="line">        .send_delay_resp = <span class="keyword">nullptr</span>,</div>
<div class="line">        .get_timestamp = platform_get_timestamp,</div>
<div class="line">        .get_tx_timestamp = <span class="keyword">nullptr</span>,</div>
<div class="line">        .adjust_clock = platform_adjust_clock,</div>
<div class="line">        .adjust_frequency = <span class="keyword">nullptr</span>,</div>
<div class="line">        .on_state_change = <span class="keyword">nullptr</span>,</div>
<div class="line">        .on_fault = <span class="keyword">nullptr</span></div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Create ordinary clock (single port)</span></div>
<div class="line">    <a class="code hl_class" href="../../dc/dd4/classIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1OrdinaryClock.html">OrdinaryClock</a> clock(config, callbacks);</div>
<div class="line">    clock.initialize();</div>
<div class="line">    clock.start();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Main loop</span></div>
<div class="line">    <span class="keywordtype">bool</span> running = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordflow">while</span> (running) {</div>
<div class="line">        <span class="comment">// Periodic processing (every 1ms)</span></div>
<div class="line">        <a class="code hl_struct" href="../../d4/d6e/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types_1_1Timestamp.html">Timestamp</a> now = platform_get_timestamp();</div>
<div class="line">        clock.tick(now);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Process received messages (pseudo-code)</span></div>
<div class="line">        <span class="keywordflow">if</span> (message_available()) {</div>
<div class="line">            uint8_t msg_type;</div>
<div class="line">            uint8_t buffer[512];</div>
<div class="line">            <span class="keywordtype">size_t</span> size;</div>
<div class="line">            <a class="code hl_struct" href="../../d4/d6e/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types_1_1Timestamp.html">Timestamp</a> rx_ts;</div>
<div class="line">            receive_message(&amp;msg_type, buffer, &amp;size, &amp;rx_ts);</div>
<div class="line">            clock.process_message(msg_type, buffer, size, rx_ts);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Check synchronization status</span></div>
<div class="line">        <span class="keywordflow">if</span> (clock.is_synchronized()) {</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; current = clock.get_port().get_current_data_set();</div>
<div class="line">            printf(<span class="stringliteral">&quot;Synchronized! Offset: %.1f ns, Delay: %.1f ns\n&quot;</span>,</div>
<div class="line">                   current.offsetFromMaster.toNanoseconds(),</div>
<div class="line">                   current.meanPathDelay.toNanoseconds());</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        usleep(1000);  <span class="comment">// Sleep 1ms</span></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    clock.stop();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1OrdinaryClock_html"><div class="ttname"><a href="../../dc/dd4/classIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1OrdinaryClock.html">IEEE::_1588::PTP::_2019::Clocks::OrdinaryClock</a></div><div class="ttdoc">Ordinary Clock State Machine.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc5/clocks_8hpp_source.html#l00837">clocks.hpp:837</a></div></div>
<div class="ttc" id="aclocks_8hpp_html"><div class="ttname"><a href="../../dd/dc5/clocks_8hpp.html">clocks.hpp</a></div><div class="ttdoc">IEEE 1588-2019 PTP Clock State Machines Implementation.</div></div>
<div class="ttc" id="anamespaceIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_html"><div class="ttname"><a href="../../dc/dd4/namespaceIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks.html">IEEE::_1588::PTP::_2019::Clocks</a></div><div class="ttdoc">IEEE 1588-2019 Clock State Machines.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc5/clocks_8hpp_source.html#l00056">clocks.hpp:56</a></div></div>
<div class="ttc" id="anamespaceIEEE_1_1__1588_1_1PTP_1_1__2019_html"><div class="ttname"><a href="../../dd/de4/namespaceIEEE_1_1__1588_1_1PTP_1_1__2019.html">IEEE::_1588::PTP::_2019</a></div><div class="ttdoc">IEEE 1588-2019 PTP v2.1 implementation.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc5/clocks_8hpp_source.html#l00046">clocks.hpp:46</a></div></div>
<div class="ttc" id="astructIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration_html"><div class="ttname"><a href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html">IEEE::_1588::PTP::_2019::Clocks::PortConfiguration</a></div><div class="ttdoc">PTP Port Configuration.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc5/clocks_8hpp_source.html#l00118">clocks.hpp:118</a></div></div>
<div class="ttc" id="astructIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration_html_a0dfd4f47e3ad115479bd6e6a1dcdf081"><div class="ttname"><a href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#a0dfd4f47e3ad115479bd6e6a1dcdf081">IEEE::_1588::PTP::_2019::Clocks::PortConfiguration::port_number</a></div><div class="ttdeci">Types::PortNumber port_number</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc5/clocks_8hpp_source.html#l00119">clocks.hpp:119</a></div></div>
<div class="ttc" id="astructIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration_html_a8545975661ddb1dc889b2cfb8c352027"><div class="ttname"><a href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#a8545975661ddb1dc889b2cfb8c352027">IEEE::_1588::PTP::_2019::Clocks::PortConfiguration::announce_receipt_timeout</a></div><div class="ttdeci">std::uint8_t announce_receipt_timeout</div><div class="ttdoc">Timeout multiplier.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc5/clocks_8hpp_source.html#l00124">clocks.hpp:124</a></div></div>
<div class="ttc" id="astructIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration_html_aa764c35035684c70a5b8bcf1e0e5bc52"><div class="ttname"><a href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#aa764c35035684c70a5b8bcf1e0e5bc52">IEEE::_1588::PTP::_2019::Clocks::PortConfiguration::delay_req_interval</a></div><div class="ttdeci">std::uint8_t delay_req_interval</div><div class="ttdoc">Log message interval.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc5/clocks_8hpp_source.html#l00123">clocks.hpp:123</a></div></div>
<div class="ttc" id="astructIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration_html_ae1b43b1516202d34b9f3e0d0bf5f1da3"><div class="ttname"><a href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#ae1b43b1516202d34b9f3e0d0bf5f1da3">IEEE::_1588::PTP::_2019::Clocks::PortConfiguration::sync_interval</a></div><div class="ttdeci">std::uint8_t sync_interval</div><div class="ttdoc">Log message interval.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc5/clocks_8hpp_source.html#l00122">clocks.hpp:122</a></div></div>
<div class="ttc" id="astructIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration_html_aee1d6d3ff0bb368d16fbb14b32cb5dbd"><div class="ttname"><a href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#aee1d6d3ff0bb368d16fbb14b32cb5dbd">IEEE::_1588::PTP::_2019::Clocks::PortConfiguration::domain_number</a></div><div class="ttdeci">Types::DomainNumber domain_number</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc5/clocks_8hpp_source.html#l00120">clocks.hpp:120</a></div></div>
<div class="ttc" id="astructIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration_html_af7f20c773006a8150a5a89f6b81f8a82"><div class="ttname"><a href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#af7f20c773006a8150a5a89f6b81f8a82">IEEE::_1588::PTP::_2019::Clocks::PortConfiguration::announce_interval</a></div><div class="ttdeci">std::uint8_t announce_interval</div><div class="ttdoc">Log message interval.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc5/clocks_8hpp_source.html#l00121">clocks.hpp:121</a></div></div>
<div class="ttc" id="astructIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1StateCallbacks_html"><div class="ttname"><a href="../../d4/dea/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1StateCallbacks.html">IEEE::_1588::PTP::_2019::Clocks::StateCallbacks</a></div><div class="ttdoc">State Machine Callbacks.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc5/clocks_8hpp_source.html#l00404">clocks.hpp:404</a></div></div>
<div class="ttc" id="astructIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1StateCallbacks_html_ae7369a8c4ad5b9c9220267a258aaf34a"><div class="ttname"><a href="../../d4/dea/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1StateCallbacks.html#ae7369a8c4ad5b9c9220267a258aaf34a">IEEE::_1588::PTP::_2019::Clocks::StateCallbacks::send_announce</a></div><div class="ttdeci">Types::PTPError(* send_announce)(const AnnounceMessage &amp;msg)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc5/clocks_8hpp_source.html#l00406">clocks.hpp:406</a></div></div>
<div class="ttc" id="astructIEEE_1_1__1588_1_1PTP_1_1__2019_1_1PTPMessage_html"><div class="ttname"><a href="../../d0/de3/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1PTPMessage.html">IEEE::_1588::PTP::_2019::PTPMessage</a></div><div class="ttdoc">Complete PTP Message template combining header and body.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d64/messages_8hpp_source.html#l00519">messages.hpp:519</a></div></div>
<div class="ttc" id="astructIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types_1_1Timestamp_html"><div class="ttname"><a href="../../d4/d6e/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types_1_1Timestamp.html">IEEE::_1588::PTP::_2019::Types::Timestamp</a></div><div class="ttdoc">PTP Timestamp - seconds and nanoseconds representation.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/de3/types_8hpp_source.html#l00154">types.hpp:154</a></div></div>
<div class="ttc" id="atypes_8hpp_html"><div class="ttname"><a href="../../dd/de3/types_8hpp.html">types.hpp</a></div><div class="ttdoc">IEEE 1588-2019 PTP v2.1 fundamental data types and constants.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md77"></a>
9.2 Master Clock</h2>
<p>Example of PTP master clock (grandmaster):</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Configure master port</span></div>
<div class="line">    <a class="code hl_struct" href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html">PortConfiguration</a> config;</div>
<div class="line">    config.<a class="code hl_variable" href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#a0dfd4f47e3ad115479bd6e6a1dcdf081">port_number</a> = 1;</div>
<div class="line">    config.<a class="code hl_variable" href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#aee1d6d3ff0bb368d16fbb14b32cb5dbd">domain_number</a> = 0;</div>
<div class="line">    config.<a class="code hl_variable" href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#af7f20c773006a8150a5a89f6b81f8a82">announce_interval</a> = 1;  <span class="comment">// 2 seconds</span></div>
<div class="line">    config.<a class="code hl_variable" href="../../d7/df2/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1PortConfiguration.html#ae1b43b1516202d34b9f3e0d0bf5f1da3">sync_interval</a> = 0;      <span class="comment">// 1 second</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Setup callbacks (master sends Announce, Sync, Follow_Up, Delay_Resp)</span></div>
<div class="line">    <a class="code hl_struct" href="../../d4/dea/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1StateCallbacks.html">StateCallbacks</a> callbacks = {</div>
<div class="line">        .send_announce = send_announce_impl,</div>
<div class="line">        .send_sync = send_sync_impl,</div>
<div class="line">        .send_follow_up = send_follow_up_impl,</div>
<div class="line">        .send_delay_req = <span class="keyword">nullptr</span>,  <span class="comment">// Master doesn&#39;t send Delay_Req</span></div>
<div class="line">        .send_delay_resp = send_delay_resp_impl,</div>
<div class="line">        .get_timestamp = platform_get_timestamp,</div>
<div class="line">        .get_tx_timestamp = platform_get_tx_timestamp,  <span class="comment">// For precise T1 in Follow_Up</span></div>
<div class="line">        .adjust_clock = <span class="keyword">nullptr</span>,  <span class="comment">// Master doesn&#39;t adjust its clock</span></div>
<div class="line">        .adjust_frequency = <span class="keyword">nullptr</span>,</div>
<div class="line">        .on_state_change = state_change_handler,</div>
<div class="line">        .on_fault = fault_handler</div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Configure master with high priority</span></div>
<div class="line">    <a class="code hl_class" href="../../dc/dd4/classIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1OrdinaryClock.html">OrdinaryClock</a> clock(config, callbacks);</div>
<div class="line">    <span class="keyword">auto</span>&amp; port = clock.get_port();</div>
<div class="line">    <span class="keyword">auto</span>&amp; defaults = <span class="keyword">const_cast&lt;</span><a class="code hl_struct" href="../../df/dd3/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1DefaultDataSet.html">DefaultDataSet</a>&amp;<span class="keyword">&gt;</span>(port.get_default_data_set());</div>
<div class="line">    defaults.priority1 = 100;  <span class="comment">// Higher priority (lower value)</span></div>
<div class="line">    defaults.clockQuality.clockClass = 6;  <span class="comment">// GPS-locked</span></div>
<div class="line">    </div>
<div class="line">    clock.initialize();</div>
<div class="line">    clock.start();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Main loop</span></div>
<div class="line">    <span class="keywordflow">while</span> (running) {</div>
<div class="line">        <a class="code hl_struct" href="../../d4/d6e/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Types_1_1Timestamp.html">Timestamp</a> now = platform_get_timestamp();</div>
<div class="line">        clock.tick(now);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Process received Delay_Req messages</span></div>
<div class="line">        <span class="keywordflow">if</span> (message_available()) {</div>
<div class="line">            process_incoming_message(clock);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Check if we&#39;re master</span></div>
<div class="line">        <span class="keywordflow">if</span> (clock.is_master()) {</div>
<div class="line">            <span class="comment">// Acting as master</span></div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        usleep(1000);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    clock.stop();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="astructIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1DefaultDataSet_html"><div class="ttname"><a href="../../df/dd3/structIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1DefaultDataSet.html">IEEE::_1588::PTP::_2019::Clocks::DefaultDataSet</a></div><div class="ttdoc">Default Data Set per IEEE 1588-2019 Section 8.2.1.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/dc5/clocks_8hpp_source.html#l00270">clocks.hpp:270</a></div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md79"></a>
10. Platform Integration</h1>
<h2><a class="anchor" id="autotoc_md80"></a>
10.1 CMake Integration</h2>
<div class="fragment"><div class="line"># Find PTP library</div>
<div class="line">find_package(IEEE1588_2019 REQUIRED)</div>
<div class="line"> </div>
<div class="line"># Link to your application</div>
<div class="line">target_link_libraries(my_application</div>
<div class="line">    PRIVATE</div>
<div class="line">        IEEE1588_2019::PTP</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># Include directories</div>
<div class="line">target_include_directories(my_application</div>
<div class="line">    PRIVATE</div>
<div class="line">        ${IEEE1588_2019_INCLUDE_DIRS}</div>
<div class="line">)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md81"></a>
10.2 FetchContent Integration</h2>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">    IEEE1588_2019</div>
<div class="line">    GIT_REPOSITORY https://github.com/[organization]/IEEE_1588_2019</div>
<div class="line">    GIT_TAG v1.0.0-MVP</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(IEEE1588_2019)</div>
<div class="line"> </div>
<div class="line">target_link_libraries(my_application</div>
<div class="line">    PRIVATE</div>
<div class="line">        IEEE1588_2019::PTP</div>
<div class="line">)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md82"></a>
10.3 Build Options</h2>
<div class="fragment"><div class="line"># Optional features</div>
<div class="line">option(IEEE1588_ENABLE_LOGGING &quot;Enable debug logging&quot; ON)</div>
<div class="line">option(IEEE1588_ENABLE_METRICS &quot;Enable performance metrics&quot; ON)</div>
<div class="line">option(IEEE1588_ENABLE_HEALTH &quot;Enable health monitoring&quot; ON)</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md84"></a>
Appendix A: Quick Reference</h1>
<h2><a class="anchor" id="autotoc_md85"></a>
Common Operations</h2>
<div class="fragment"><div class="line"><span class="comment">// Create and initialize clock</span></div>
<div class="line"><a class="code hl_class" href="../../dc/dd4/classIEEE_1_1__1588_1_1PTP_1_1__2019_1_1Clocks_1_1OrdinaryClock.html">OrdinaryClock</a> clock(config, callbacks);</div>
<div class="line">clock.initialize();</div>
<div class="line">clock.start();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Main loop</span></div>
<div class="line"><span class="keywordflow">while</span> (running) {</div>
<div class="line">    clock.tick(get_current_time());</div>
<div class="line">    <span class="keywordflow">if</span> (message_available()) {</div>
<div class="line">        clock.process_message(type, data, size, timestamp);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check status</span></div>
<div class="line"><span class="keywordflow">if</span> (clock.is_synchronized()) { <span class="comment">/* ... */</span> }</div>
<div class="line"><span class="keywordflow">if</span> (clock.is_master()) { <span class="comment">/* ... */</span> }</div>
<div class="line"><span class="keywordflow">if</span> (clock.is_slave()) { <span class="comment">/* ... */</span> }</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get synchronization quality</span></div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span>&amp; current = clock.get_port().get_current_data_set();</div>
<div class="line"><span class="keywordtype">double</span> offset_ns = current.offsetFromMaster.toNanoseconds();</div>
<div class="line"><span class="keywordtype">double</span> delay_ns = current.meanPathDelay.toNanoseconds();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Shutdown</span></div>
<div class="line">clock.stop();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md86"></a>
Common Pitfalls</h2>
<ol type="1">
<li><b>Forgetting to call tick()</b>: Must call periodically (e.g., every 1ms-125ms)</li>
<li><b>Missing TX timestamps</b>: Two-step sync requires precise TX timestamps</li>
<li><b>Incorrect HAL implementation</b>: Callbacks must be non-blocking</li>
<li><b>Clock adjustment too aggressive</b>: Can cause instability</li>
<li><b>Wrong log intervals</b>: log2 values (0=1s, 1=2s, -1=0.5s, etc.)</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md88"></a>
Appendix B: IEEE 1588-2019 Section References</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">API Component   </th><th class="markdownTableHeadNone"><a class="el" href="../../d0/d1c/namespaceIEEE.html" title="Top-level IEEE standards namespace.">IEEE</a> 1588-2019 Section    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Timestamp   </td><td class="markdownTableBodyNone">Section 5.3.3    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ClockIdentity   </td><td class="markdownTableBodyNone">Section 5.3.4    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PortState   </td><td class="markdownTableBodyNone">Section 9.2.5    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">PTPHeader   </td><td class="markdownTableBodyNone">Section 13.3    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Announce   </td><td class="markdownTableBodyNone">Section 13.5    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Sync   </td><td class="markdownTableBodyNone">Section 13.6    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Follow_Up   </td><td class="markdownTableBodyNone">Section 13.7    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Delay_Req   </td><td class="markdownTableBodyNone">Section 13.8    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Delay_Resp   </td><td class="markdownTableBodyNone">Section 13.9    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">BMCA   </td><td class="markdownTableBodyNone">Section 9.3    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Data Sets   </td><td class="markdownTableBodyNone">Section 8.2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">State Machines   </td><td class="markdownTableBodyNone">Section 9.2    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Clock Types   </td><td class="markdownTableBodyNone">Section 6.5   </td></tr>
</table>
<hr  />
<p><b>End of API Reference Guide</b></p>
<p>For integration guidance, see Integration Guide. <br  />
 For getting started, see Getting Started Tutorial. <br  />
 For troubleshooting, see Troubleshooting Guide.</p>
<hr  />
<p><b>Document Version</b>: 1.0.0 <br  />
 <b>Last Updated</b>: 2025-11-11 <br  />
 <b>Status</b>: Complete for MVP release </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
