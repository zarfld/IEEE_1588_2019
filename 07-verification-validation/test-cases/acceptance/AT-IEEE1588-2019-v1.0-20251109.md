# Acceptance Test Plan (ATP)
Project: IEEE 1588-2019 PTPv2
Version: 1.0
Date: 2025-11-09
Integrity Level: 2
Owners: Customer/Acquirer: TBD, QA Lead: TBD
Status: Draft

## 1. Purpose and Scope
- Validate that the IEEE 1588-2019 protocol implementation meets stakeholder acceptance criteria for compliance, performance, portability, security, usability, and maintainability.
- Out of scope: Hardware/driver-specific timing features; external interoperability events (to be validated in lab and referenced as external evidence).
- Features covered: BMCA, message formats, offset/delay calc, port/clock roles, documentation and CI evidence, no-buffer-overrun checks.

## 2. References
- Requirements Spec: 02-requirements/system-requirements-specification.md
- Acceptance Traceability Overview: 07-verification-validation/traceability/stakeholder-requirements-to-tests.md
- Architecture/Design: 03-architecture/ieee-1588-2019-ptpv2-architecture-spec.md
- Test Strategy: 07-verification-validation/acceptance-tests-strategy.md
- User Documentation: README.md; docs/

## 3. Acceptance Criteria Summary
| ID | Requirement/User Story | Acceptance Criterion | Rationale |
|----|------------------------|----------------------|-----------|
| AC-001 | STR-STD-001 | BMCA decisions match spec across tie and priority cases | Protocol correctness |
| AC-002 | STR-STD-002 | Message headers/body validation rejects malformed inputs | Robustness & security |
| AC-003 | STR-PERF-001 | Offset and delay computations produce expected bounds on samples | Accuracy |
| AC-004 | STR-PERF-004 | Path delay mechanism computes bounded error under simulated jitter | Determinism |
| AC-005 | STR-PORT-001 | Core builds with no OS/vendor headers; DI used for callbacks | Portability |
| AC-006 | STR-SEC-002 | Undersized buffers return INVALID_MESSAGE_SIZE; no overruns | Memory safety |
| AC-007 | STR-USE-001 | Public headers include @file and @brief markers | Documentation |
| AC-008 | STR-USE-002, STR-MAINT-002, STR-MAINT-004 | CI workflows present; README has Getting Started; community doc exists/planned | Operability |
| AC-009 | STR-STD-004 | Interoperability demonstrated with commercial device (external evidence) | Integration |
| AC-010 | STR-PERF-003 | Servo convergence under simulated Sync cycles reaches stability criteria | Performance |
| AC-011 | STR-STD-003 | Multi-instance BMCA + sync path produces Master/Slave roles and stable offset | Protocol end-to-end |
| AC-012 | STR-PERF-002 | Sync processing logical path executes within deterministic time bound | Determinism |
| AC-013 | STR-MAINT-003 | At least one approved ADR present with required metadata | Maintainability |
| AC-014 | STR-PORT-004 | CMake-based cross-platform build system artifacts present | Portability |

## 4. Test Design (End-to-End Journeys)
Selection: Risk-based and operationally significant journeys for protocol bring-up and operation.

| Journey ID | Title | Priority | Integrity | Rationale |
|------------|-------|----------|-----------|-----------|
| J-001 | BMCA election across multiple ports | P1 | 2 | Core correctness |
| J-002 | Message parsing/validation pipeline | P1 | 2 | Security & robustness |
| J-003 | Offset/delay compute loop | P1 | 2 | Accuracy |
| J-004 | Delay request/response round trip | P1 | 2 | Determinism |
| J-005 | Build portability & DI | P1 | 2 | Maintain hardware-agnostic contract |
| J-006 | Documentation & CI presence | P1 | 1 | Usability & maintainability |
| J-007 | Interoperability external lab run | P1 | 2 | Real-world validation |
| J-008 | Servo convergence simulation | P1 | 2 | Performance |

## 5. Acceptance Test Cases (Scenario Format)

ATC-001: BMCA master selection in tie case (P1)
Related: STR-STD-001, STR-STD-003
Given multiple ports with equal priority and class
When BMCA executes selection
Then a deterministic tie-break rule selects a single master
And the chosen clock ID matches expected rule ordering

ATC-002: Reject undersized Sync message (P1)
Related: STR-STD-002, STR-SEC-002
Given a parse request with fewer bytes than minimum header size
When validate_header() runs
Then return INVALID_MESSAGE_SIZE
And no memory access occurs beyond bounds

ATC-003: Offset and delay under jitter (P1)
Related: STR-PERF-001, STR-PERF-004
Given simulated T1..T4 samples with bounded jitter
When compute_offset_and_delay() runs across N>100 samples
Then 95th percentile offset error < configured bound
And delay estimate variance below threshold

ATC-004: Evidence of portability and DI (P1)
Related: STR-PORT-001
Given a compile-only target with mock callbacks
When linked against the concrete library
Then construction and linkage succeed without OS/vendor includes

ATC-005: API docs & getting started (P1)
Related: STR-USE-001, STR-USE-002, STR-MAINT-002, STR-MAINT-004
Given repository root
When scanning headers and README/CI
Then headers contain @file/@brief, README has Getting Started, workflows exist, and CONTRIBUTING is present or warned

ATC-006: Interoperability evidence (P1)
Related: STR-STD-004
Given an external lab report and packet captures against Device X (GM)
When reviewing artifacts
Then interop criteria are met (announce/Sync negotiation, delay handling, role agreement)

ATC-007: Servo convergence (P1)
Related: STR-PERF-003
ATC-008: Multi-instance BMCA + Sync/Delay (P1)
Related: STR-STD-003, STR-PERF-003
Given two ordinary clocks with differing priority1 values
When Announce, Sync, Follow_Up, Delay_Req, Delay_Resp sequences are exchanged deterministically
Then the lower priority value clock enters MASTER state after qualification
And the peer transitions to SLAVE after ≥3 successful offset samples
And computed offset magnitude remains within expected synthetic bound (|offset| < 1e6 ns in test harness)

ATC-009: Timing determinism logical path (P1)
Related: STR-PERF-002
Given an initialized ordinary clock with stub callbacks
When a full Sync→Follow_Up→Delay_Req→Delay_Resp processing slice executes
Then total execution time SHALL be <100 microseconds on reference development host
And no dynamic allocation occurs in the measured path (verified by code review / static analysis)

ATC-010: ADR presence (P1)
Related: STR-MAINT-003
Given repository architecture decisions directory
When scanning for ADR-* markdown files with required front matter keys (id, status, phase)
Then at least one approved ADR SHALL be found

ATC-011: Build system presence (P1)
Related: STR-PORT-004
Given repository root and build artifacts
When checking for CMakeLists.txt and config template
Then both SHALL exist indicating cross-platform build system configuration
Given simulated Sync sequence with gradual offset
When servo applies corrections
Then residual error converges below epsilon within M cycles
And remains stable without oscillation beyond threshold

## 6. Procedures (Data, Environment, Steps)
PROC-001: BMCA tie selection
- Steps: Run `bmca_tie_passive`, `bmca_role_assignment` and verify outputs.
- Data: Deterministic config set included in tests.

PROC-002: Message validation
- Steps: Run `ptp_message_header_validation`, `ptp_message_bodies_validation`.

PROC-003: Offset/Delay
- Steps: Run `offset_calculation_robustness`, `calculate_offset_and_delay`, `delay_resp_processing`.

PROC-004: Portability & DI
- Steps: Build `dependency_injection_compile` and verify exit code 0.

PROC-005: Docs & Getting Started
- Steps: Run `api_docs_presence`, `getting_started_and_ci_presence`.

PROC-006: Interoperability
- Steps: Manual lab; capture PCAP/wireshark logs; attach report under `07-verification-validation/test-results/interop/`.

PROC-007: Servo convergence (planned)
- Steps: Implement `servo_convergence_sim` test harness; assert convergence metrics.

## 7. Automation Strategy
- Framework: CTest via CMake; evidence tests as small executables.
- CI: GitHub Actions (`.github/workflows/ci.yml`, `ci-standards-compliance.yml`) to run unit + acceptance evidence.
- Data: Deterministic seeds in tests; no flaky network dependencies.
- Flake mitigation: Bounded iterations, timeouts, retry guards in tests.

## 8. Traceability Matrix
| Req/Story | Acceptance Criterion | Test Case ID | Procedure | Result |
|-----------|----------------------|--------------|----------|--------|
| STR-STD-001 | BMCA tie-break selects deterministic master | ATC-001 | PROC-001 | Covered by: `bmca_tie_passive`, `bmca_role_assignment_integration` |
| STR-STD-002 | Reject malformed headers/bodies | ATC-002 | PROC-002 | Covered by: `ptp_message_header_validation`, `ptp_message_bodies_validation` |
| STR-PERF-001 | Offset error within bound | ATC-003 | PROC-003 | Covered by: `offset_calculation_robustness`, `calculate_offset_and_delay` |
| STR-PERF-004 | Delay estimate variance below threshold | ATC-003 | PROC-003 | Covered by: `delay_resp_processing` |
| STR-PORT-001 | Builds w/o OS/vendor includes | ATC-004 | PROC-004 | Covered by: `dependency_injection_compile` |
| STR-SEC-002 | No buffer overruns | ATC-002 | PROC-002 | Covered by: `no_buffer_overruns` |
| STR-USE-001 | Header documentation present | ATC-005 | PROC-005 | Covered by: `api_docs_presence` |
| STR-USE-002 | Getting Started in README | ATC-005 | PROC-005 | Covered by: `getting_started_and_ci_presence` |
| STR-MAINT-002 | CI workflows configured | ATC-005 | PROC-005 | Covered by: `getting_started_and_ci_presence` |
| STR-STD-004 | Interoperability proven | ATC-006 | PROC-006 | Pending (external evidence) |
| STR-PERF-003 | Servo convergence | ATC-007 | PROC-007 | Covered by: `servo_convergence_sim`, `multi_instance_bmca_sync` |
| STR-STD-003 | Multi-instance BMCA election & role stability | ATC-008 | PROC-001 | Covered by: `multi_instance_bmca_sync`, `bmca_role_assignment_integration` |
| STR-PERF-002 | Deterministic Sync processing | ATC-009 | PROC-003 | Covered by: `timing_determinism` |
| STR-MAINT-003 | ADR present | ATC-010 | PROC-005 | Covered by: `adrs_presence` |
| STR-PORT-004 | Build system artifacts | ATC-011 | PROC-004 | Covered by: `build_system_presence` |

## 9. Risk, Hazard, and Security Checks
- Abuse cases: malformed packets, buffer underflow/overflow attempts (guarded).
- Privacy: Not applicable (no PII stored); ensure logs don’t leak secrets.
- Hazard: Time skew causing system effects; bounds asserted in offset/delay tests.

## 10. Expected Results and Oracles
- Numeric oracles: offset/delay bounds, deterministic role assignment.
- Structural oracles: header tags, CI files present, README section.
- External oracles: interop report artifacts.

## 11. Entry/Exit Criteria
Entry:
- Stakeholder acceptance criteria enumerated; CI green.
Exit:
- 100% of P1 journeys pass; external interop evidence attached or waived for sprint.

## 12. Documentation Adequacy Check
- README contains Getting Started.
- Public headers include Doxygen markers.
- Tutorials/examples directory present.

## 13. Results and Acceptance Decision
| Test Case | Result | Evidence | Defects |
|-----------|--------|----------|---------|
| ATC-001 | PASS | CTest log | - |
| ATC-002 | PASS | CTest log | - |
| ATC-003 | PASS | CTest log | - |
| ATC-004 | PASS | CTest log | - |
| ATC-005 | PASS | CTest log | - |
| ATC-006 | PENDING | Interop lab report | - |
| ATC-007 | PASS | CTest log | - |
| ATC-008 | PASS | CTest log | - |
| ATC-009 | PASS | CTest log | - |
| ATC-010 | PASS | CTest log | - |
| ATC-011 | PASS | CTest log | - |
Decision: CONDITIONAL ACCEPT (pending interop external evidence; all simulated acceptance criteria passing)

## 14. Follow-Up Actions
- Attach interop report artifacts and update matrix to PASS.
- Enable a CI step to run acceptance evidence targets and publish traceability report.
- Add OS assumptions scan (for STR-PORT-003) and example/porting guide evidence (STR-USE-003/004).
